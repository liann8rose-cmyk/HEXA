<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HEXA · Register</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow:wght@300;400;600&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: #000;
    color: #fff;
    font-family: 'Barlow', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  #hexCanvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
  }

  .page {
    position: relative;
    z-index: 10;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
  }

  /* ── LOGO AREA ── */
  .logo-area {
    position: relative;
    width: 220px;
    height: 220px;
    margin-bottom: 10px;
  }

  #logoCanvas {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
  }

  .logo-text {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 72px;
    letter-spacing: 0.12em;
    background: linear-gradient(135deg, #fff 30%, #00f0ff 70%, #ff00ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(0 0 20px rgba(0,240,255,0.5));
    animation: logoPulse 3s ease-in-out infinite;
  }

  @keyframes logoPulse {
    0%, 100% { filter: drop-shadow(0 0 20px rgba(0,240,255,0.5)); }
    50% { filter: drop-shadow(0 0 40px rgba(255,0,255,0.7)); }
  }

  .subtitle {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 15px;
    letter-spacing: 0.5em;
    color: #00f0ff;
    margin-bottom: 40px;
    opacity: 0.8;
  }

  /* ── FORM CARD ── */
  .card {
    width: 100%;
    max-width: 460px;
    background: rgba(0,240,255,0.03);
    border: 1px solid rgba(0,240,255,0.18);
    border-radius: 4px;
    padding: 40px 36px;
    backdrop-filter: blur(10px);
    animation: slideUp 0.8s 0.3s ease forwards;
    opacity: 0;
    transform: translateY(30px);
  }

  @keyframes slideUp {
    to { opacity: 1; transform: translateY(0); }
  }

  .card h2 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 28px;
    letter-spacing: 0.25em;
    color: #fff;
    margin-bottom: 28px;
    text-align: center;
  }

  .field {
    margin-bottom: 20px;
  }

  .field label {
    display: block;
    font-size: 11px;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.45);
    margin-bottom: 8px;
    font-weight: 600;
  }

  .field input {
    width: 100%;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 2px;
    padding: 13px 16px;
    color: #fff;
    font-family: 'Barlow', sans-serif;
    font-size: 15px;
    outline: none;
    transition: border-color 0.3s, box-shadow 0.3s;
  }

  .field input:focus {
    border-color: #00f0ff;
    box-shadow: 0 0 16px rgba(0,240,255,0.15);
  }

  .field input::placeholder {
    color: rgba(255,255,255,0.2);
  }

  .toggle-btn {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 14px;
    letter-spacing: 0.2em;
    padding: 8px 20px;
    background: transparent;
    border: 1px solid rgba(255,255,255,0.15);
    color: rgba(255,255,255,0.4);
    border-radius: 2px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .toggle-btn.active {
    border-color: #00f0ff;
    color: #00f0ff;
    box-shadow: 0 0 12px rgba(0,240,255,0.2);
  }

  .toggle-btn:hover {
    border-color: #ff00ff;
    color: #ff00ff;
  }

  /* age warning inline */
  .age-note {
    font-size: 11px;
    color: #ff4466;
    margin-top: 6px;
    display: none;
  }

  .terms {
    font-size: 12px;
    color: rgba(255,255,255,0.35);
    line-height: 1.7;
    margin-bottom: 24px;
    text-align: center;
  }

  .terms a {
    color: #00f0ff;
    text-decoration: none;
  }

  .btn-register {
    width: 100%;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 20px;
    letter-spacing: 0.25em;
    padding: 16px;
    background: linear-gradient(135deg, #00f0ff, #0077cc);
    color: #000;
    border: none;
    border-radius: 2px;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
  }

  .btn-register::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, #ff00ff, #7700ff);
    opacity: 0;
    transition: opacity 0.4s;
  }

  .btn-register:hover::after { opacity: 1; }
  .btn-register span { position: relative; z-index: 1; color: #000; }
  .btn-register:hover span { color: #fff; }
  .btn-register:hover { transform: translateY(-2px); box-shadow: 0 0 30px rgba(0,240,255,0.4); }

  .signin-link {
    text-align: center;
    margin-top: 20px;
    font-size: 13px;
    color: rgba(255,255,255,0.35);
  }

  .signin-link a {
    color: #ff00ff;
    text-decoration: none;
    font-weight: 600;
  }

  .signin-link a:hover { color: #00f0ff; }

  /* ── SUCCESS STATE ── */
  .success {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    text-align: center;
    padding: 20px 0;
  }

  .success-hex {
    font-size: 60px;
    animation: spin 4s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .success h3 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 32px;
    letter-spacing: 0.2em;
    color: #00f0ff;
  }

  .success p {
    font-size: 14px;
    color: rgba(255,255,255,0.6);
    line-height: 1.7;
  }

  .back-link {
    margin-top: 30px;
    font-size: 12px;
    color: rgba(255,255,255,0.25);
    letter-spacing: 0.2em;
    text-transform: uppercase;
    cursor: pointer;
    text-decoration: none;
    display: block;
    text-align: center;
  }

  .back-link:hover { color: #00f0ff; }
</style>
</head>
<body>

<canvas id="hexCanvas"></canvas>

<div class="page">

  <!-- FLYING HEXAGON LOGO -->
  <div class="logo-area">
    <canvas id="logoCanvas"></canvas>
    <div class="logo-text">HEXA</div>
  </div>

  <div class="subtitle">Create Your Account</div>

  <!-- REGISTER CARD -->
  <div class="card" id="formCard">
    <h2>Join HEXA</h2>

    <div class="field">
      <label>Full Name</label>
      <input type="text" id="fullname" placeholder="Enter your full name" />
    </div>

    <div class="field">
      <label>Age</label>
      <input type="number" id="age" placeholder="Your age" min="1" max="120" />
      <div class="age-note" id="ageNote">⚠ You must be 16 or older to join HEXA.</div>
    </div>

    <div class="field">
      <label>Email Address</label>
      <input type="email" id="email" placeholder="your@email.com" />
    </div>

    <div class="field">
      <label>Password</label>
      <input type="password" id="password" placeholder="Create a strong password" />
    </div>

    <div class="field">
      <label>Password Recovery Backup</label>
      <div style="display:flex; gap:10px; margin-bottom:10px;">
        <button type="button" class="toggle-btn active" id="btnEmail" onclick="switchBackup('email')">Email</button>
        <button type="button" class="toggle-btn" id="btnPhone" onclick="switchBackup('phone')">Phone Number</button>
      </div>
      <input type="email" id="backupEmail" placeholder="Backup email address" />
      <input type="tel" id="backupPhone" placeholder="e.g. +1 234 567 8900" style="display:none;" />
      <div style="font-size:11px; color:rgba(255,255,255,0.3); margin-top:6px; letter-spacing:0.05em;">
        Used only to recover your password if you forget it.
      </div>
    </div>

    <button class="btn-register" onclick="handleRegister()">
      <span>Create Account</span>
    </button>

    <div class="signin-link">
      Already have an account? <a href="hexa-landing.html">Sign In</a>
    </div>

    <!-- SUCCESS -->
    <div class="success" id="successMsg">
      <div class="success-hex">⬡</div>
      <h3>Welcome to HEXA</h3>
      <p>Your account has been created.<br>You're now part of the HEXA community.</p>
    </div>
  </div>

  <a href="hexa-landing.html" class="back-link">← Back to HEXA</a>
</div>

<script>
// ── BACKGROUND HEX CANVAS (same as landing) ──────────────
const bgCanvas = document.getElementById('hexCanvas');
const bgCtx = bgCanvas.getContext('2d');
let BW, BH, bgHexs = [];

const COLORS = ['#00f0ff','#ff00ff','#7700ff','#0044ff','#00ffaa','#ff4466','#ffcc00'];

function bgResize() {
  BW = bgCanvas.width = window.innerWidth;
  BH = bgCanvas.height = window.innerHeight;
  buildBg();
}

function buildBg() {
  bgHexs = [];
  const r = 38;
  const cols = Math.ceil(BW / (r * 1.75)) + 2;
  const rows = Math.ceil(BH / (r * 1.55)) + 2;
  for (let row = -1; row < rows; row++) {
    for (let col = -1; col < cols; col++) {
      bgHexs.push({
        x: col * r * 1.75 + (row % 2 === 0 ? 0 : r * 0.875),
        y: row * r * 1.52,
        r,
        color: COLORS[Math.floor(Math.random() * COLORS.length)],
        targetColor: COLORS[Math.floor(Math.random() * COLORS.length)],
        progress: Math.random(),
        speed: 0.002 + Math.random() * 0.004,
        alpha: 0.03 + Math.random() * 0.08,
        pulse: Math.random() * Math.PI * 2,
        pulseSpeed: 0.01 + Math.random() * 0.02
      });
    }
  }
}

function lerpColor(c1, c2, t) {
  const parse = c => [parseInt(c.slice(1,3),16), parseInt(c.slice(3,5),16), parseInt(c.slice(5,7),16)];
  const [r1,g1,b1] = parse(c1), [r2,g2,b2] = parse(c2);
  return `rgb(${Math.round(r1+(r2-r1)*t)},${Math.round(g1+(g2-g1)*t)},${Math.round(b1+(b2-b1)*t)})`;
}

function bgAnimate() {
  bgCtx.clearRect(0,0,BW,BH);
  bgHexs.forEach(h => {
    h.progress += h.speed; h.pulse += h.pulseSpeed;
    if (h.progress >= 1) { h.progress = 0; h.color = h.targetColor; h.targetColor = COLORS[Math.floor(Math.random()*COLORS.length)]; }
    const col = lerpColor(h.color, h.targetColor, h.progress);
    const a = h.alpha + Math.sin(h.pulse) * 0.03;
    bgCtx.beginPath();
    for (let i = 0; i < 6; i++) {
      const ang = Math.PI/180*(60*i-30);
      i===0 ? bgCtx.moveTo(h.x+h.r*Math.cos(ang), h.y+h.r*Math.sin(ang))
             : bgCtx.lineTo(h.x+h.r*Math.cos(ang), h.y+h.r*Math.sin(ang));
    }
    bgCtx.closePath();
    bgCtx.strokeStyle = col; bgCtx.globalAlpha = Math.max(0.02,a); bgCtx.lineWidth = 1; bgCtx.stroke();
  });
  bgCtx.globalAlpha = 1;
  requestAnimationFrame(bgAnimate);
}

window.addEventListener('resize', bgResize);
bgResize(); bgAnimate();

// ── FLYING HEXAGONS AROUND LOGO ───────────────────────────
const lc = document.getElementById('logoCanvas');
const lctx = lc.getContext('2d');
lc.width = 220; lc.height = 220;

const cx = 110, cy = 110;
const orbiters = Array.from({length: 8}, (_, i) => ({
  angle: (i / 8) * Math.PI * 2,
  radius: 70 + Math.random() * 30,
  speed: (0.008 + Math.random() * 0.012) * (Math.random() > 0.5 ? 1 : -1),
  size: 8 + Math.random() * 10,
  color: COLORS[i % COLORS.length],
  alpha: 0.5 + Math.random() * 0.5,
  trail: []
}));

function drawSmallHex(ctx, x, y, r, color, alpha) {
  ctx.beginPath();
  for (let i = 0; i < 6; i++) {
    const ang = Math.PI/180*(60*i-30);
    i===0 ? ctx.moveTo(x+r*Math.cos(ang), y+r*Math.sin(ang))
           : ctx.lineTo(x+r*Math.cos(ang), y+r*Math.sin(ang));
  }
  ctx.closePath();
  ctx.strokeStyle = color;
  ctx.globalAlpha = alpha;
  ctx.lineWidth = 1.5;
  ctx.stroke();
  ctx.fillStyle = color;
  ctx.globalAlpha = alpha * 0.25;
  ctx.fill();
}

function logoAnimate() {
  lctx.clearRect(0, 0, 220, 220);

  // center glow ring
  const grad = lctx.createRadialGradient(cx,cy,30,cx,cy,100);
  grad.addColorStop(0, 'rgba(0,240,255,0.08)');
  grad.addColorStop(1, 'rgba(0,0,0,0)');
  lctx.fillStyle = grad;
  lctx.globalAlpha = 1;
  lctx.beginPath();
  lctx.arc(cx, cy, 100, 0, Math.PI*2);
  lctx.fill();

  orbiters.forEach(o => {
    o.angle += o.speed;
    const x = cx + Math.cos(o.angle) * o.radius;
    const y = cy + Math.sin(o.angle) * o.radius;

    // trail
    o.trail.push({x, y, a: o.alpha});
    if (o.trail.length > 6) o.trail.shift();
    o.trail.forEach((pt, i) => {
      drawSmallHex(lctx, pt.x, pt.y, o.size * 0.6, o.color, pt.a * (i / o.trail.length) * 0.4);
    });

    drawSmallHex(lctx, x, y, o.size, o.color, o.alpha);
  });

  lctx.globalAlpha = 1;
  requestAnimationFrame(logoAnimate);
}

logoAnimate();

function switchBackup(type) {
  document.getElementById('backupEmail').style.display = type === 'email' ? 'block' : 'none';
  document.getElementById('backupPhone').style.display = type === 'phone' ? 'block' : 'none';
  document.getElementById('btnEmail').classList.toggle('active', type === 'email');
  document.getElementById('btnPhone').classList.toggle('active', type === 'phone');
}

// ── FORM LOGIC ────────────────────────────────────────────
const SUPA_URL = 'https://nfxyxnmatuzmqctttqnk.supabase.co';
const SUPA_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5meHl4bm1hdHV6bXFjdHR0cW5rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1OTI5ODgsImV4cCI6MjA4NzE2ODk4OH0.86r1EeHHYEIpye1UuJnnxrlGpL9DixSfk-l5xId8pwg';

async function handleRegister() {
  const name = document.getElementById('fullname').value.trim();
  const age = parseInt(document.getElementById('age').value);
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  const ageNote = document.getElementById('ageNote');
  const btn = document.querySelector('.btn-register span');

  if (age < 16) { ageNote.style.display = 'block'; return; }
  else { ageNote.style.display = 'none'; }

  if (!name || !age || !email || !password) {
    alert('Please fill in all required fields.');
    return;
  }

  btn.textContent = 'Creating Account...';

  try {
    // Sign up with Supabase Auth
    const res = await fetch(SUPA_URL + '/auth/v1/signup', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'apikey': SUPA_KEY
      },
      body: JSON.stringify({ email, password })
    });
    const data = await res.json();

    if (data.error) {
      alert('Error: ' + data.error.message);
      btn.textContent = 'Create Account';
      return;
    }

    // Save extra user info to users table
    await fetch(SUPA_URL + '/rest/v1/users', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'apikey': SUPA_KEY,
        'Authorization': 'Bearer ' + SUPA_KEY
      },
      body: JSON.stringify({
        id: data.user?.id,
        username: name,
        email: email,
        age: age,
        created_at: new Date().toISOString()
      })
    });

    // Save session
    sessionStorage.setItem('hexa_token', data.access_token || 'local_' + Date.now());
    sessionStorage.setItem('hexa_username', name);
    sessionStorage.setItem('hexa_email', email);

    // Show success
    document.querySelector('.card h2').style.display = 'none';
    document.querySelectorAll('.field').forEach(f => f.style.display = 'none');
    document.querySelector('.btn-register').style.display = 'none';
    document.querySelector('.signin-link').style.display = 'none';
    const s = document.getElementById('successMsg');
    s.style.display = 'flex';
    setTimeout(() => { window.location.href = 'hexa-welcome.html'; }, 2000);

  } catch(e) {
    alert('Connection error. Please try again.');
    btn.textContent = 'Create Account';
  }
}
</script>
</body>
</html>
